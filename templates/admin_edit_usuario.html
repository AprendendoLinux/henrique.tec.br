{% extends "base.html" %}

{% block title %}Alterar Senha | Henrique Fagundes{% endblock %}

{% block content %}
<div class="max-w-xl mx-auto px-6 py-10 w-full flex-grow">
    
    <div class="mb-10">
        <a href="/admin/dashboard" class="text-neon font-mono text-sm hover:underline"><- Voltar ao Painel</a>
    </div>

    <div class="glass-card p-6 md:p-8 rounded-xl border-l-2 border-l-yellow-500">
        <h2 class="text-2xl font-bold text-white mb-2 border-l-2 border-yellow-500 pl-3">Alterar Senha</h2>
        <p class="text-gray-400 text-sm mb-6 pl-3">Usuário: <span class="text-white font-mono">{{ usuario.username }}</span></p>
        
        <form action="/admin/usuarios/edit/{{ usuario.id }}" method="POST" class="space-y-6">
            
            <div>
                <label class="block text-gray-400 text-xs font-mono mb-2">NOVA SENHA:</label>
                <div class="relative">
                    <input type="password" id="edit_pwd" name="password" required 
                           pattern="(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9]).{8,}"
                           title="Mínimo 8 caracteres, 1 maiúscula, 1 número e 1 símbolo."
                           class="w-full bg-[#111] border border-gray-700 text-white px-4 py-2 rounded focus:outline-none focus:border-yellow-500 transition pr-10">
                    <button type="button" onclick="togglePassword('edit_pwd', 'eye_edit_pwd')" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-white transition focus:outline-none">
                        <i id="eye_edit_pwd" class="fa-solid fa-eye"></i>
                    </button>
                </div>
                <p class="text-[10px] text-gray-500 mt-1 font-mono">Requisito: Min 8 chars, 1 Maiúscula, 1 Número, 1 Símbolo.</p>
            </div>

            <div>
                <label class="block text-gray-400 text-xs font-mono mb-2">CONFIRMAR NOVA SENHA:</label>
                <div class="relative">
                    <input type="password" id="edit_conf_pwd" name="confirm_password" required class="w-full bg-[#111] border border-gray-700 text-white px-4 py-2 rounded focus:outline-none focus:border-yellow-500 transition pr-10">
                    <button type="button" onclick="togglePassword('edit_conf_pwd', 'eye_edit_conf')" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-white transition focus:outline-none">
                        <i id="eye_edit_conf" class="fa-solid fa-eye"></i>
                    </button>
                </div>
            </div>

            <div class="text-right mt-8">
                <button type="submit" class="px-6 py-2 bg-yellow-500 text-darkbg font-bold font-mono rounded hover:bg-white hover:text-darkbg transition">>_ GRAVAR NOVA SENHA</button>
            </div>
        </form>
    </div>
</div>

<script>
    function togglePassword(inputId, iconId) {
        const input = document.getElementById(inputId);
        const icon = document.getElementById(iconId);
        if (input.type === "password") {
            input.type = "text";
            icon.classList.remove("fa-eye");
            icon.classList.add("fa-eye-slash", "text-neon");
        } else {
            input.type = "password";
            icon.classList.remove("fa-eye-slash", "text-neon");
            icon.classList.add("fa-eye");
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('erro') === 'senhas_diferentes') {
            alert('[!] ACESSO NEGADO: As senhas digitadas não conferem. Tente novamente.');
        } else if(urlParams.get('erro') === 'senha_fraca') {
            alert('[!] ACESSO NEGADO: A senha deve ter no mínimo 8 caracteres, 1 letra maiúscula, 1 número e 1 símbolo.');
        }
    });
</script>
{% endblock %}